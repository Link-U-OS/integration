package(default_visibility = ["//visibility:public"])

licenses(["notice"])

cc_library(
    name = "Foundation",
    srcs = glob(
        ["Foundation/src/*.cpp"],
        exclude = [
            "Foundation/src/PipeImpl_POSIX.cpp",
            "Foundation/src/PipeImpl_DUMMY.cpp",
            "Foundation/src/PipeImpl_WIN32.cpp",
            "Foundation/src/Windows1250Encoding.cpp",
            "Foundation/src/Windows1251Encoding.cpp",
            "Foundation/src/Windows1252Encoding.cpp",
            "Foundation/src/WindowsConsoleChannel.cpp",
            "Foundation/src/DirectoryIterator_UNIX.cpp",
            "Foundation/src/DirectoryIterator_WIN32U.cpp",
            "Foundation/src/Environment_UNIX.cpp",
            "Foundation/src/Environment_VX.cpp",
            "Foundation/src/Environment_WIN32U.cpp",
            "Foundation/src/Environment_WINCE.cpp",
            "Foundation/src/Event_POSIX.cpp",
            "Foundation/src/Event_VX.cpp",
            "Foundation/src/Event_WIN32.cpp",
            "Foundation/src/File_UNIX.cpp",
            "Foundation/src/File_VX.cpp",
            "Foundation/src/File_WIN32U.cpp",
            "Foundation/src/File_WINCE.cpp",
            "Foundation/src/FileStream_POSIX.cpp",
            "Foundation/src/FileStream_WIN32.cpp",
            "Foundation/src/FPEnvironment_C99.cpp",
            "Foundation/src/FPEnvironment_DEC.cpp",
            "Foundation/src/FPEnvironment_DUMMY.cpp",
            "Foundation/src/FPEnvironment_QNX.cpp",
            "Foundation/src/FPEnvironment_SUN.cpp",
            "Foundation/src/FPEnvironment_WIN32.cpp",
            "Foundation/src/Mutex_POSIX.cpp",
            "Foundation/src/Mutex_VX.cpp",
            "Foundation/src/Mutex_WIN32.cpp",
            "Foundation/src/Mutex_WINCE.cpp",
            "Foundation/src/NamedEvent_UNIX.cpp",
            "Foundation/src/NamedEvent_Android.cpp",
            "Foundation/src/NamedEvent_WIN32U.cpp",
            "Foundation/src/NamedMutex_UNIX.cpp",
            "Foundation/src/NamedMutex_Android.cpp",
            "Foundation/src/NamedMutex_WIN32U.cpp",
            "Foundation/src/Path_UNIX.cpp",
            "Foundation/src/Path_WIN32U.cpp",
            "Foundation/src/Path_WINCE.cpp",
            "Foundation/src/Process_UNIX.cpp",
            "Foundation/src/Process_VX.cpp",
            "Foundation/src/Process_WIN32U.cpp",
            "Foundation/src/Process_WINCE.cpp",
            "Foundation/src/RWLock_POSIX.cpp",
            "Foundation/src/RWLock_Android.cpp",
            "Foundation/src/RWLock_VX.cpp",
            "Foundation/src/RWLock_WIN32.cpp",
            "Foundation/src/RWLock_WINCE.cpp",
            "Foundation/src/Semaphore_POSIX.cpp",
            "Foundation/src/Semaphore_VX.cpp",
            "Foundation/src/Semaphore_WIN32.cpp",
            "Foundation/src/SharedMemory_POSIX.cpp",
            "Foundation/src/SharedMemory_WIN32.cpp",
            "Foundation/src/SharedMemory_DUMMY.cpp",
            "Foundation/src/SharedLibrary_UNIX.cpp",
            "Foundation/src/SharedLibrary_HPUX.cpp",
            "Foundation/src/SharedLibrary_VX.cpp",
            "Foundation/src/SharedLibrary_WIN32U.cpp",
            "Foundation/src/TextEncoding.cpp",
            "Foundation/src/Thread_POSIX.cpp",
            "Foundation/src/Thread_VX.cpp",
            "Foundation/src/Thread_WIN32.cpp",
            "Foundation/src/Thread_WINCE.cpp",
            "Foundation/src/Timezone_VX.cpp",
            "Foundation/src/Timezone_WIN32.cpp",
            "Foundation/src/Timezone_WINCE.cpp",
            "Foundation/src/Timezone_UNIX.cpp",
            "Foundation/src/LogFile_WIN32U.cpp",
            "Foundation/src/LogFile_STD.cpp",
            "Foundation/src/EventLogChannel.cpp",
        ],
    ) + [
        # pcre 源文件
        "Foundation/src/pcre_config.c",
        "Foundation/src/pcre_byte_order.c",
        "Foundation/src/pcre_chartables.c",
        "Foundation/src/pcre_compile.c",
        "Foundation/src/pcre_exec.c",
        "Foundation/src/pcre_fullinfo.c",
        "Foundation/src/pcre_globals.c",
        "Foundation/src/pcre_maketables.c",
        "Foundation/src/pcre_newline.c",
        "Foundation/src/pcre_ord2utf8.c",
        "Foundation/src/pcre_study.c",
        "Foundation/src/pcre_tables.c",
        "Foundation/src/pcre_dfa_exec.c",
        "Foundation/src/pcre_get.c",
        "Foundation/src/pcre_jit_compile.c",
        "Foundation/src/pcre_refcount.c",
        "Foundation/src/pcre_string_utils.c",
        "Foundation/src/pcre_version.c",
        "Foundation/src/pcre_ucd.c",
        "Foundation/src/pcre_valid_utf8.c",
        "Foundation/src/pcre_xclass.c",

        # zlib 源文件
        "Foundation/src/adler32.c",
        "Foundation/src/compress.c",
        "Foundation/src/crc32.c",
        "Foundation/src/deflate.c",
        "Foundation/src/infback.c",
        "Foundation/src/inffast.c",
        "Foundation/src/inflate.c",
        "Foundation/src/inftrees.c",
        "Foundation/src/trees.c",
        "Foundation/src/zutil.c",
    ],
    hdrs = glob(
        [
            "Foundation/include/**/*.h",
            "Foundation/src/*.h",
        ],
        exclude = [
            "Foundation/include/Poco/WindowsConsoleChannel.h",
            "Foundation/include/Poco/Windows1250Encoding.h",
            "Foundation/include/Poco/Windows1251Encoding.h",
            "Foundation/include/Poco/Windows1252Encoding.h",
            "Foundation/include/Poco/DirectoryIterator_WIN32U.h",
            "Foundation/include/Poco/Environment_VX.h",
            "Foundation/include/Poco/Environment_WIN32U.h",
            "Foundation/include/Poco/Environment_WINCE.h",
            "Foundation/include/Poco/File_VX.h",
            "Foundation/include/Poco/File_WIN32U.h",
            "Foundation/include/Poco/File_WINCE.h",
            "Foundation/include/Poco/FileStream_WIN32.h",
            "Foundation/include/Poco/FPEnvironment_DEC.h",
            "Foundation/include/Poco/FPEnvironment_DUMMY.h",
            "Foundation/include/Poco/FPEnvironment_QNX.h",
            "Foundation/include/Poco/FPEnvironment_SUN.h",
            "Foundation/include/Poco/FPEnvironment_WIN32.h",
            "Foundation/include/Poco/Mutex_VX.h",
            "Foundation/include/Poco/Mutex_WIN32.h",
            "Foundation/include/Poco/Mutex_WINCE.h",
            "Foundation/include/Poco/NamedEvent_Android.h",
            "Foundation/include/Poco/NamedEvent_WIN32U.h",
            "Foundation/include/Poco/NamedMutex_Android.h",
            "Foundation/include/Poco/NamedMutex_WIN32U.h",
            "Foundation/include/Poco/Path_WIN32U.h",
            "Foundation/include/Poco/Path_WINCE.h",
            "Foundation/include/Poco/PipeImpl_DUMMY.h",
            "Foundation/include/Poco/PipeImpl_WIN32.h",
            "Foundation/include/Poco/Platform_WIN32.h",
            "Foundation/include/Poco/Process_VX.h",
            "Foundation/include/Poco/Process_WIN32U.h",
            "Foundation/include/Poco/Process_WINCE.h",
            "Foundation/include/Poco/RWLock_Android.h",
            "Foundation/include/Poco/RWLock_VX.h",
            "Foundation/include/Poco/RWLock_WIN32.h",
            "Foundation/include/Poco/RWLock_WINCE.h",
            "Foundation/include/Poco/Semaphore_VX.h",
            "Foundation/include/Poco/Semaphore_WIN32.h",
            "Foundation/include/Poco/SharedLibrary_HPUX.h",
            "Foundation/include/Poco/SharedLibrary_VX.h",
            "Foundation/include/Poco/SharedLibrary_WIN32U.h",
            "Foundation/include/Poco/SharedMemory_DUMMY.h",
            "Foundation/include/Poco/SharedMemory_WIN32.h",
            "Foundation/include/Poco/Thread_VX.h",
            "Foundation/include/Poco/Thread_WIN32.h",
            "Foundation/include/Poco/Thread_WINCE.h",
            "Foundation/include/Poco/LogFile_WIN32U.h",
            "Foundation/include/Poco/EventLogChannel.h",
        ],
    ),
    defines = [
        "Foundation_EXPORTS",
        "_REENTRANT",
        "_THREAD_SAFE",
        "_LARGEFILE64_SOURCE",
        "_FILE_OFFSET_BITS=64",
        "_XOPEN_SOURCE=500",
        "POCO_HAVE_FD_EPOLL",
        "POCO_OS_FAMILY_UNIX",
    ],
    includes = [
        "Foundation/include",
        "Foundation/include/Poco",
    ],
    linkopts = [
        "-pthread",
        "-ldl",
        "-lrt",
    ],
    textual_hdrs = [
        "Foundation/src/PipeImpl_POSIX.cpp",
        "Foundation/src/DirectoryIterator_UNIX.cpp",
        "Foundation/src/Environment_UNIX.cpp",
        "Foundation/src/Event_POSIX.cpp",
        "Foundation/src/File_UNIX.cpp",
        "Foundation/src/FileStream_POSIX.cpp",
        "Foundation/src/FPEnvironment_C99.cpp",
        "Foundation/src/Mutex_POSIX.cpp",
        "Foundation/src/NamedEvent_UNIX.cpp",
        "Foundation/src/NamedMutex_UNIX.cpp",
        "Foundation/src/Path_UNIX.cpp",
        "Foundation/src/Process_UNIX.cpp",
        "Foundation/src/RWLock_POSIX.cpp",
        "Foundation/src/Semaphore_POSIX.cpp",
        "Foundation/src/SharedLibrary_UNIX.cpp",
        "Foundation/src/SharedMemory_POSIX.cpp",
        "Foundation/src/Thread_POSIX.cpp",
        "Foundation/src/Timezone_UNIX.cpp",
        "Foundation/src/LogFile_STD.cpp",

        "Foundation/src/diy-fp.cc",
        "Foundation/src/cached-powers.cc",
        "Foundation/src/bignum-dtoa.cc",
        "Foundation/src/bignum.cc",
        "Foundation/src/fast-dtoa.cc",
        "Foundation/src/fixed-dtoa.cc",
        "Foundation/src/strtod.cc",
        "Foundation/src/double-conversion.cc",

    ],
)

cc_library(
    name = "Util",
    srcs = glob(
        ["Util/src/*.cpp"],
        exclude = [
            "Util/src/WinRegistryConfiguration.cpp",
            "Util/src/WinRegistryKey.cpp",
            "Util/src/WinService.cpp",
        ],
    ),
    hdrs = glob(
        ["Util/include/**/*.h"],
        exclude = [
            "Util/include/Poco//Util/WinRegistryConfiguration.h",
            "Util/include/Poco//Util/WinRegistryKey.h",
            "Util/include/Poco//Util/WinService.h",
        ],
    ),
    defines = [
        "POCO_UTIL_NO_XMLCONFIGURATION",
        "POCO_UTIL_NO_JSONCONFIGURATION",
    ],
    includes = [
        "Util/include",
        "Util/include/Poco",
        "Util/include/Poco/Util",
    ],
    deps = [
        ":Foundation",
    ],
)
