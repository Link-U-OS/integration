#
#  ALSA library configuration file
#
#  SPDX-FileCopyrightText: Copyright (c) 2018-2021 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
#  SPDX-License-Identifier: LicenseRef-NvidiaProprietary
#
# NVIDIA CORPORATION, its affiliates and licensors retain all intellectual
# property and proprietary rights in and to this material, related
# documentation and any modifications thereto. Any use, reproduction,
# disclosure or distribution of this material and related documentation
# without an express license agreement from NVIDIA CORPORATION or
# its affiliates is strictly prohibited.

pcm.!default {
	type plug
	slave {
		pcm "hw:APE,0"
		channels 2
		rate 48000
	}
	hint.description "Tegra APE Soundcard"
}

ctl.!default {
	type hw
	card APE
}

pcm.playback_def {
	type dmix
        ipc_key 1015008
        ipc_key_add_uid false
        ipc_perm 0666
	slave {
		pcm "hw:APE,0"
		rate 48000
		channels 2
        period_time 0
        period_size 1024
        buffer_size 8192
		format S16_LE
	}
}


pcm.playback_usb {
	type dmix
        ipc_key 1015009
        ipc_key_add_uid false
        ipc_perm 0666
	slave {
		pcm "hw:DefUsbPDevice,0,0"
		rate 48000
		channels 2
        period_time 0
        period_size 1024
        buffer_size 4096
		format S16_LE
	}
}

# pcm.playback_loopback {
# 	# type dmix
#     #     ipc_key 1015009
#     #     ipc_key_add_uid false
#     #     ipc_perm 0666
# 	type plug
#   	slave {
# 		pcm "hw:Loopback,0,1"
# 		rate 48000
# 		channels 1
# 		format S16_LE
# 	  }
# }

pcm.multi {
    type route
    slave.pcm {
        type multi
        slaves {
            a {
                pcm "playback_usb"
                channels 2
            }
            b {
                pcm "dmix_loopout"
                channels 1
            }
        }
        bindings {
            0 { slave a; channel 0 }
            1 { slave a; channel 1 }
            2 { slave b; channel 0 }
        }
    }
    ttable {
        0.0 1.0    # 左声道 -> USB播放设备左声道
        1.1 1.0    # 右声道 -> USB播放设备右声道
        0.2 0.1    # 左声道 -> 环回输出(10%音量)
    }
}

pcm.multiplay {
	type plug
	slave.pcm "multi"
}

pcm.playback_def_plug {
    type plug
    slave.pcm "playback_def"
}

pcm.multi_def {
    type route
    slave.pcm {
        type multi
        slaves {
            a { pcm "playback_def_plug" channels 1 }
            b { pcm "loop_out" channels 1 }
        }
        bindings [
            { slave a channel 0 }
            { slave b channel 0 }
        ]
    }
    ttable [
        [ 1.0 0.1 ]
    ]
}

pcm.speaker_out {
    type plug
    slave {
        pcm "hw:APE,0"
        format S16_LE
        rate 48000
        channels 2
    }
}

pcm.multiplay_def {
	type plug
	slave.pcm "multi_def"
}

pcm.dsp0 {
    type plug
    slave.pcm "dmixer"
}

pcm.playback_loopback {
    type plug
    slave.pcm "dmix_loopout"
}

pcm.dmix_loopout {
    type dmix
    ipc_key 1025
    ipc_perm 0666
    slave {
        pcm "loopout_hw"
        rate 48000
        period_time 0
        period_size 1024
        buffer_size 4096
        channels 1
    }
}

pcm.loopout_hw {
    type hw
    card Loopback
    device 0
    subdevice 2
}



pcm.dmixer {
    type dmix
    ipc_key 1024
    ipc_key_add_uid true
    slave {
        pcm "hw:APE,0"
        period_time 0
        period_size 1024
        buffer_size 4096
        rate 48000
        format S16_LE
        channels 2
    }
    bindings {
        0 0
        1 1
    }
}

pcm.capture_def_usb {
	type plug
	slave {
		pcm "hw:DefCDevice,0"
		rate 48000
		channels 1
		format S16_LE
	}
}

pcm.capture_usb {
	type plug
	slave {
		pcm "hw:DefUsbCDevice,0"
		rate 48000
		channels 1
		format S16_LE
	}
}

pcm.capture_usb_2c {
	type plug
	slave {
		pcm "hw:UsbCDevice2c16,0"
		rate 48000
		channels 2
		format S16_LE
	}
}

pcm.capture_usb_2c_S24_3LE {
	type plug
	slave {
		pcm "hw:UsbCDevice2c243,0"
		rate 48000
		channels 2
		format S24_3LE
	}
}

pcm.capture_loopback {
	type plug
	slave {
		pcm "hw:Loopback,1,2"
		rate 48000
		channels 1
		format S16_LE
	}
}

pcm.cmulti {
    type route
    slave.pcm {
        type multi
        slaves.a.pcm "capture_usb"
        slaves.a.channels 1
        slaves.b.pcm "capture_loopback"
        slaves.b.channels 1
        bindings.0.slave a
        bindings.0.channel 0
        bindings.1.slave b
        bindings.1.channel 0
    }
    ttable {
        0.0 1
        1.1 1
    }
}

pcm.multicapture {
        type plug
        slave.pcm "cmulti"
}


pcm.cmulti_2c {
    type route
    slave.pcm {
        type multi
        slaves.a.pcm "capture_usb_2c"
        slaves.a.channels 1
        slaves.b.pcm "capture_loopback"
        slaves.b.channels 1
        bindings.0.slave a
        bindings.0.channel 0
        bindings.1.slave b
        bindings.1.channel 0
    }
    ttable {
        0.0 1
        1.1 1
    }
}

pcm.multicapture_2c {
        type plug
        slave.pcm "cmulti_2c"
}

pcm.cmulti_2c_24 {
    type route
    slave.pcm {
        type multi
        slaves.a.pcm "capture_usb_2c_S24_3LE"
        slaves.a.channels 1
        slaves.b.pcm "capture_loopback"
        slaves.b.channels 1
        bindings.0.slave a
        bindings.0.channel 0
        bindings.1.slave b
        bindings.1.channel 0
    }
    ttable {
        0.0 1
        1.1 1
    }
}

pcm.multicapture_2c_24 {
        type plug
        slave.pcm "cmulti_2c_24"
}

pcm.cmulti_def {
    type route
    slave.pcm {
        type multi
        slaves.a.pcm "capture_def_usb"
        slaves.a.channels 1
        slaves.b.pcm "capture_loopback"
        slaves.b.channels 1
        bindings.0.slave a
        bindings.0.channel 0
        bindings.1.slave b
        bindings.1.channel 0
    }
    ttable {
        0.0 1
        1.1 1
    }
}

pcm.multicapture_def {
	type plug
	slave.pcm "cmulti_def"
}


pcm.demixer {
	type plug
	slave {
		pcm "dmix:APE,0"
		channels 2
		rate 48000
	}
}

pcm.bt_device {
    type plug
    slave.pcm "bt_loop_duplicate"
}

pcm.bt_loop_duplicate {
    type route
    slave.pcm {
        type multi
        slaves {
            a { pcm "bt_spk" channels 1 }
            b { pcm "loop_out" channels 1 }
        }
        bindings [
            { slave a channel 0 }
            { slave b channel 0 }
        ]
    }
    ttable [
        [ 1.0 0.1 ]
    ]
}

pcm.bt_dynamic {
    type bluealsa
    device {
        @func getenv
        vars [ BLUETOOTH_MAC ]
        default "50:1B:6A:DE:0A:2F"
    }
    profile "a2dp"
}

pcm.bt_spk {
    type plug
    slave {
        pcm "bt_dynamic"
        format S16_LE
        rate 48000
        channels 1
    }
}

pcm.loop_out {
    type plug
    slave {
        pcm "hw:Loopback,0,2"
        format S16_LE
        rate 48000
        channels 1
    }
}

pcm.loop_in {
    type dsnoop
    ipc_key 223456
    slave {
        pcm "hw:Loopback,1,2"
        format S16_LE
        rate 48000
        channels 1
    }
}